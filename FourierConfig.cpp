#include "FourierConfig.h"

#include "FftwAlgorithm.h"
#include "SamplingInfo.h"

namespace WaveAnalysis
{

////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////
/// constructor
////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////
FourierConfig::FourierConfig( const SamplingInfo& samplingInfo, size_t windowSize, const WindowFuncDef& windowFuncDef, size_t numSamplesZeroPadding ) :
   m_samplingInfo( samplingInfo ),
   m_windowSize( windowSize ),
   m_windowFuncDef( windowFuncDef.clone() ),
   m_windowFunction( windowFuncDef.createWindowFunction( windowSize ) ),
   m_numSamplesZeroPadding( numSamplesZeroPadding )
{
   initFrequencyList();
}

////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////
/// initFrequencyList
////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////
void FourierConfig::initFrequencyList()
{
   size_t numFrequencies = getSpectrumDimension();
   m_frequencies.resize( numFrequencies );
   double lowestFrequency = getLowestFrequency();
   for ( size_t i = 0; i < numFrequencies; ++i )
   {
      m_frequencies[i] = lowestFrequency * i;
   }
}

////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////
/// getSpectrumDimension
////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////
size_t FourierConfig::getSpectrumDimension() const
{
   return FftwAlgorithm::getSpectrumDimension( getTotalFourierSize() );
}

////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////
/// getLowestFrequency
////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////
double FourierConfig::getLowestFrequency() const
{
   return m_samplingInfo.getSamplingRate() / getTotalFourierSize();
}

////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////
/// Global functions
////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////

////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////
/// comparisoon operator
////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////
bool operator!=( const FourierConfig& fc1, const FourierConfig& fc2 )
{
   if ( fc1.m_samplingInfo          != fc2.m_samplingInfo ) return true;
   if ( fc1.m_windowSize            != fc2.m_windowSize ) return true;
   if ( fc1.m_windowFuncDef         != fc2.m_windowFuncDef ) return true;
   if ( fc1.m_numSamplesZeroPadding != fc2.m_numSamplesZeroPadding ) return true;

   /// Other data is generated via these data
   return false;
}

bool operator==( const FourierConfig& fc1, const FourierConfig& fc2 )
{
   return !( fc1 != fc2 );
}

} /// namespace WaveAnalysis
